import showToast from"./app.js";const DEFAULT_AVATAR="https://i.postimg.cc/KvF0rh0Q/custom-default-avatar.png";async function loadAuthenticatedUser(){const o=localStorage.getItem("token");if(o)try{const t=await fetch("/api/users/me",{headers:{Authorization:`Bearer ${o}`}});if(!t.ok)return;const e=await t.json(),s=document.getElementById("navUserAvatar");s&&(s.src=e.profilePhoto?.trim()?e.profilePhoto:DEFAULT_AVATAR),window.currentUser=e}catch(o){console.warn("Failed to load auth user:",o)}}const forgotPasswordLink=document.getElementById("forgotPasswordLink"),forgotPasswordModal=document.getElementById("forgotPasswordModal"),closeForgotModal=document.getElementById("closeForgotModal");forgotPasswordLink.addEventListener("click",o=>{o.preventDefault(),forgotPasswordModal.classList.remove("hidden")}),closeForgotModal.addEventListener("click",()=>{forgotPasswordModal.classList.add("hidden")});const forgotPasswordForm=document.getElementById("forgotPasswordForm");forgotPasswordForm.addEventListener("submit",async o=>{o.preventDefault();const t=document.getElementById("forgotEmail").value.trim();try{const o=await fetch("/api/auth/forgot-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t})}),e=await o.json();showToast(e.message||"Check your email for the reset link.","success"),forgotPasswordModal.classList.add("hidden")}catch(o){console.error(o),showToast("Failed to send reset link. Try again.","error")}}),document.addEventListener("DOMContentLoaded",loadAuthenticatedUser);