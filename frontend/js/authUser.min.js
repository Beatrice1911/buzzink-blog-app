import{showToast}from"./app.js";const DEFAULT_AVATAR="https://i.postimg.cc/KvF0rh0Q/custom-default-avatar.png";async function loadAuthenticatedUser(){const e=localStorage.getItem("token");if(e)try{const t=await fetch("/api/users/me",{headers:{Authorization:`Bearer ${e}`}});if(!t.ok)return;const o=await t.json(),a=document.getElementById("navUserAvatar");a&&(a.src=o.profilePhoto?.trim()?o.profilePhoto:DEFAULT_AVATAR),window.currentUser=o}catch(e){console.warn("Failed to load auth user:",e)}}document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("forgotPasswordLink"),t=document.getElementById("forgotPasswordModal"),o=document.getElementById("closeForgotModal"),a=document.getElementById("forgotPasswordForm");e&&e.addEventListener("click",e=>{e.preventDefault(),t.classList.remove("hidden")}),o&&o.addEventListener("click",()=>{t.classList.add("hidden")}),a&&a.addEventListener("submit",async e=>{e.preventDefault();const o=document.getElementById("forgotEmail").value.trim();try{const e=await fetch("/api/auth/forgot-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:o})}),a=await e.json();showToast(a.message||"Check your email for the reset link.","success"),t.classList.add("hidden")}catch(e){console.error(e),showToast("Failed to send reset link. Try again.","error")}})}),document.addEventListener("DOMContentLoaded",loadAuthenticatedUser);