const token=localStorage.getItem("token"),role=localStorage.getItem("role");async function checkAdmin(){const e=localStorage.getItem("token");if(!e)return redirectHome();const t=await fetch("/api/users/me",{headers:{Authorization:`Bearer ${e}`}}),n=await t.json();return n&&"admin"===n.role?void 0:redirectHome()}function redirectHome(){alert("Access denied. Admins only."),window.location.href="/index.html"}const sidebarLinks=document.querySelectorAll(".sidebar .nav-links a"),sections={Overview:document.querySelector(".overview-cards"),Users:document.getElementById("users-section"),Posts:document.getElementById("posts-section"),Comments:document.getElementById("comments-section"),Settings:document.getElementById("settings-section")};function hideAllSections(){Object.values(sections).forEach(e=>{e&&(e.style.display="none")})}function createRow(e,t,n){const o=document.createElement("tr");t.forEach(t=>{const n=document.createElement("td");n.textContent=e[t]||"",o.appendChild(n)});const s=document.createElement("td");if("users"===n){const t=document.createElement("button");t.textContent="Delete",t.classList.add("btn-delete"),t.onclick=()=>deleteUser(e._id,o),s.appendChild(t)}else if("posts"===n){const t=document.createElement("button");t.textContent="Delete",t.classList.add("btn-delete"),t.onclick=()=>deletePost(e._id,o),s.appendChild(t)}else if("comments"===n){const t=document.createElement("button");t.textContent="Delete",t.classList.add("btn-delete"),t.onclick=()=>deleteComment(e._id,o),s.appendChild(t)}return o.appendChild(s),o}async function loadOverviewStats(){const e=await fetch("/api/admin/stats",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),t=await e.json();document.getElementById("total-users").textContent=t.users,document.getElementById("total-posts").textContent=t.posts,document.getElementById("total-comments").textContent=t.comments}async function loadUsers(){const e=await fetch("/api/admin/users",{headers:{Authorization:`Bearer ${token}`}}),t=await e.json(),n=document.querySelector("#users-table tbody");n.innerHTML="",t.forEach(e=>{n.appendChild(createRow(e,["name","email","role"],"users"))})}async function loadPosts(){const e=await fetch("/api/admin/posts",{headers:{Authorization:`Bearer ${token}`}}),t=await e.json(),n=document.querySelector("#posts-table tbody");n.innerHTML="",t.forEach(e=>{n.appendChild(createRow(e,["title","authorName","category"],"posts"))})}async function loadComments(){const e=await fetch("/api/admin/comments",{headers:{Authorization:`Bearer ${token}`}}),t=await e.json(),n=document.querySelector("#comments-table tbody");n.innerHTML="",Array.isArray(t)?t.forEach(e=>{n.appendChild(createRow(e,["userName","postTitle","content"],"comments"))}):console.error("Comments data is not an array:",t)}async function deleteUser(e,t){confirm("Are you sure you want to delete this user?")&&(await fetch(`/api/admin/users/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${token}`}}),loadUsers())}async function deletePost(e,t){confirm("Are you sure you want to delete this post?")&&(await fetch(`/api/admin/posts/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${token}`}}),loadPosts())}async function deleteComment(e,t){confirm("Are you sure you want to delete this comment?")&&(await fetch(`/api/admin/comments/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${token}`}}),loadComments())}sidebarLinks.forEach(e=>{e.addEventListener("click",t=>{t.preventDefault(),sidebarLinks.forEach(e=>e.classList.remove("active")),e.classList.add("active");const n=e.textContent.trim();hideAllSections(),"Overview"===n?sections.Overview.style.display="flex":sections[n]&&(sections[n].style.display="block")})}),document.addEventListener("DOMContentLoaded",async()=>{await checkAdmin(),loadOverviewStats(),loadUsers(),loadPosts(),loadComments()});