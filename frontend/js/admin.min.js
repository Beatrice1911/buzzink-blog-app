const token=localStorage.getItem("token"),role=localStorage.getItem("role");async function checkAdmin(){const e=localStorage.getItem("token");if(!e)return redirectHome();const t=await fetch("/api/auth/verify",{headers:{Authorization:`Bearer ${e}`}}),o=await t.json();return o&&"admin"===o.role?void 0:redirectHome()}function redirectHome(){alert("Access denied. Admins only."),window.location.href="/index.html"}checkAdmin();const sidebarLinks=document.querySelectorAll(".sidebar .nav-links a"),sections={Overview:document.querySelector(".overview-cards"),Users:document.getElementById("users-section"),Posts:document.getElementById("posts-section"),Comments:document.getElementById("comments-section"),Settings:null};function hideAllSections(){Object.values(sections).forEach(e=>{e&&(e.style.display="none")})}function createRow(e,t,o){const n=document.createElement("tr");t.forEach(t=>{const o=document.createElement("td");o.textContent=e[t]||"",n.appendChild(o)});const s=document.createElement("td");if("users"===o){const t=document.createElement("button");t.textContent="Delete",t.classList.add("btn-delete"),t.onclick=()=>deleteUser(e._id,n),s.appendChild(t)}else if("posts"===o){const t=document.createElement("button");t.textContent="Delete",t.classList.add("btn-delete"),t.onclick=()=>deletePost(e._id,n),s.appendChild(t)}else if("comments"===o){const t=document.createElement("button");t.textContent="Delete",t.classList.add("btn-delete"),t.onclick=()=>deleteComment(e._id,n),s.appendChild(t)}return n.appendChild(s),n}async function loadUsers(){const e=await fetch("/api/admin/users",{headers:{Authorization:`Bearer ${token}`}}),t=await e.json(),o=document.querySelector("#users-table tbody");o.innerHTML="",t.forEach(e=>{o.appendChild(createRow(e,["name","email","role"],"users"))})}async function loadPosts(){const e=await fetch("/api/admin/posts",{headers:{Authorization:`Bearer ${token}`}}),t=await e.json(),o=document.querySelector("#posts-table tbody");o.innerHTML="",t.forEach(e=>{o.appendChild(createRow(e,["title","authorName","category"],"posts"))})}async function loadComments(){const e=await fetch("/api/admin/comments",{headers:{Authorization:`Bearer ${token}`}}),t=await e.json(),o=document.querySelector("#comments-table tbody");o.innerHTML="",t.forEach(e=>{o.appendChild(createRow(e,["userName","postTitle","content"],"comments"))})}async function deleteUser(e,t){confirm("Are you sure you want to delete this user?")&&(await fetch(`/api/admin/users/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${token}`}}),loadUsers())}async function deletePost(e,t){confirm("Are you sure you want to delete this post?")&&(await fetch(`/api/admin/posts/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${token}`}}),loadPosts())}async function deleteComment(e,t){confirm("Are you sure you want to delete this comment?")&&(await fetch(`/api/admin/comments/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${token}`}}),loadComments())}sidebarLinks.forEach(e=>{e.addEventListener("click",t=>{t.preventDefault(),sidebarLinks.forEach(e=>e.classList.remove("active")),e.classList.add("active");const o=e.textContent.trim();hideAllSections(),"Overview"===o?sections.Overview.style.display="flex":sections[o]&&(sections[o].style.display="block")})}),loadUsers(),loadPosts(),loadComments();